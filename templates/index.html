<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Youtube Video Downloader</title>
    <link rel="stylesheet" href="../static/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>
<body>
<div class="container">
<!-------navbar--------->
   <header class="d-flex flex-wrap justify-content-between py-3 mb-4 border-bottom">
  <a href="{{ url_for ('home') }}">
    <img src="/static/youtube.png" class="bi mx-2" height="36" width="36">
  </a>
  <ul class="nav col-md-4 justify-content-end list-unstyled d-flex">
    <li class="ms-3"><a href="#"><img src="/static/github.png" class="bi" height="34" width="34"></a></li>
    <li class="ms-3"><a href="#"><img src="/static/linkedin.png" class="bi" height="34" width="34"></a></li>
  </ul>
</header>
<!-------main------------>
     <div class="row justify-content-center">
          <div class="col-lg-8 col-md-10 col-sm-12">
            <form id="videoForm">
              <div class="mb-3">
                  <label for="exampleFormControlInput1" class="form-label">Video link</label>
                  <div class="input-group">
                  <input type="text" class="form-control" id="video_url" name="video_url" placeholder="Paste your youtube video link here.">
                  <button class="button" id="searchButton" type="button">GO</button>
                </div>
                <p class="disclaimer">Disclaimer: The video gets downloaded in the best quality available, please check the size in MB by clicking GO before starting your downlaod. Enjoy!</p>
              </div>
              <div class="gray-box d-flex align-items-center">
                <img class="thumbnail" id="thumbnail" src="/static/thumbnail.webp" alt="thumbnail" />
                <div class="description">
                  <h3 id="videoTitle">Video Title</h3>
                  <p>Approximate download size in MB: <h6 id="file_size_mb">Filesize</h6></p>
              </div>
            </div>
            </form>
            <form id="downlaodForm">
            <div class="col-lg-2 col-md-4 col-sm-6 mt-4">
              <button type="submit" name="downloadButton" class="button">download</button>
              </div>
            </form>
            <div id="message"></div>
          </div>
      </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('searchButton').addEventListener('click', function() {
      var videoUrl = document.getElementById('video_url').value;
        fetch('/search', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ video_url: videoUrl })
          })
          .then(response => response.json())
          .then(data => {
            document.getElementById('thumbnail').src = data.thumbnail_url;
            document.getElementById('videoTitle').innerText = data.title;
            document.getElementById('file_size_mb').innerText = data.file_size_mb;
        })
        .catch(error => console.error('Error:', error));
    });
    document.getElementById('downlaodForm').addEventListener('submit', function(event) {
      event.preventDefault();
        var url = document.getElementById('video_url').value;
        var messageDiv = document.getElementById('message');
        messageDiv.innerText = 'Your video downloading process has started...';
          fetch('/download', {
            method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ url: url }),
          })
          .then(response => response.json())
          .then(data => {
            if (data.error) {
              messageDiv.innerText = `Error: ${data.error}`;
            } else {
              messageDiv.innerText = `👍Download completed for ${data.title}.${data.ext}`;
            }
          })
          .catch(error => {
            messageDiv.innerText = `Error: ${error}`;
        });
      });
  });
</script>
</body>
</html>